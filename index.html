<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEVELFORGE - FPS Level Designer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- ÏÉÅÎã® Î©îÎâ¥Î∞î -->
        <header class="menubar">
            <div class="brand">
                <span class="logo">‚óÜ</span>
                <span class="title">LEVELFORGE</span>
                <span class="level-name-divider">|</span>
                <span id="levelNameDisplay" class="level-name" title="ÌÅ¥Î¶≠ÌïòÏó¨ Î†àÎ≤® Ïù¥Î¶Ñ Î≥ÄÍ≤Ω">Untitled</span>
            </div>
            <nav class="menu">
                <div class="menu-group">
                    <button id="newBtn" class="menu-btn" title="ÏÉà ÌîÑÎ°úÏ†ùÌä∏"><i class="fa-solid fa-file"></i></button>
                    <button id="openBtn" class="menu-btn" title="Ïó¥Í∏∞ (Ctrl+O)"><i class="fa-solid fa-folder-open"></i></button>
                    <button id="recentBtn" class="menu-btn" title="ÏµúÍ∑º ÌååÏùº"><i class="fa-solid fa-clock-rotate-left"></i></button>
                    <div id="recentDropdown" class="recent-dropdown" style="display:none;">
                        <div class="recent-header">ÏµúÍ∑º ÌååÏùº</div>
                        <ul id="recentList" class="recent-list"></ul>
                        <div class="recent-empty" id="recentEmpty">ÏµúÍ∑º ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§</div>
                    </div>
                    <button id="saveBtn" class="menu-btn" title="Ï†ÄÏû• (Ctrl+S)"><i class="fa-solid fa-floppy-disk"></i></button>
                    <button id="exportBtn" class="menu-btn" title="Ïù¥ÎØ∏ÏßÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞"><i class="fa-solid fa-image"></i></button>
                    <button id="exportBlenderBtn" class="menu-btn" title="BlenderÎ°ú ÎÇ¥Î≥¥ÎÇ¥Í∏∞" style="color:#ea7600"><i class="fa-solid fa-cube"></i>B</button>
                    <button id="view3dBtn" class="menu-btn" title="3D Î∑∞" style="color:#4ecdc4"><i class="fa-solid fa-cube"></i></button>
                </div>
                <div class="menu-divider"></div>
                <div class="menu-group">
                    <button id="undoBtn" class="menu-btn" title="Ïã§ÌñâÏ∑®ÏÜå (Ctrl+Z)"><i class="fa-solid fa-rotate-left"></i></button>
                    <button id="redoBtn" class="menu-btn" title="Îã§ÏãúÏã§Ìñâ (Ctrl+Y)"><i class="fa-solid fa-rotate-right"></i></button>
                </div>
                <div class="menu-divider"></div>
                <div class="menu-group tools-group" style="position:relative;">
                    <button class="menu-btn tool-btn active" data-tool="select" title="ÏÑ†ÌÉù ÎèÑÍµ¨ (V)&#10;Ïò§Î∏åÏ†ùÌä∏Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù"><i class="fa-solid fa-arrow-pointer"></i></button>
                    <button class="menu-btn tool-btn" data-tool="pan" title="Ïù¥Îèô ÎèÑÍµ¨ (Space)&#10;Ï∫îÎ≤ÑÏä§Î•º ÎìúÎûòÍ∑∏ÌïòÏó¨ Ïù¥Îèô"><i class="fa-solid fa-hand"></i></button>
                    <button class="menu-btn tool-btn" data-tool="polygon" title="Îã§Í∞ÅÌòï Î∞îÎã• (P)&#10;ÌÅ¥Î¶≠: Ï†ê Ï∂îÍ∞Ä&#10;Enter/ÎçîÎ∏îÌÅ¥Î¶≠: ÏôÑÏÑ±" style="color:#4ecdc4;"><i class="fa-solid fa-draw-polygon"></i></button>
                    <button class="menu-btn tool-btn" data-tool="spline" id="splineToolBtn" title="Ïä§ÌîåÎùºÏù∏ Î∞îÎã• (S)&#10;ÌÅ¥Î¶≠: Í≤ΩÎ°úÏ†ê Ï∂îÍ∞Ä&#10;Enter/ÎçîÎ∏îÌÅ¥Î¶≠: Î∞îÎã• ÏÉùÏÑ±" style="color:#f39c12;"><i class="fa-solid fa-bezier-curve"></i></button>
                    <button class="menu-btn tool-btn" data-tool="corridor" id="corridorToolBtn" title="ÌÜµÎ°ú Ïó∞Í≤∞ (C)&#10;Edge ÌÅ¥Î¶≠: Ïó∞Í≤∞Ï†ê ÏÑ†ÌÉù&#10;Îëê Ï†ê ÏÑ†ÌÉùÌïòÎ©¥ ÏûêÎèô Ïó∞Í≤∞" style="color:#3498db;"><i class="fa-solid fa-road"></i></button>
                    <!-- Ïä§ÌîåÎùºÏù∏ ÏòµÏÖò ÌåùÏóÖ -->
                    <div class="spline-popup" id="splineOptions" style="display:none;">
                        <div class="spline-popup-title">ÌÜµÎ°ú ÎÑàÎπÑ</div>
                        <div class="spline-popup-controls">
                            <button id="splineWidthMinus" class="spline-popup-btn">‚àí</button>
                            <span id="splineWidthLabel" class="spline-popup-value">5m</span>
                            <button id="splineWidthPlus" class="spline-popup-btn">+</button>
                        </div>
                        <input type="range" id="splineWidth" min="32" max="320" value="160" step="32" class="spline-popup-slider">
                    </div>
                </div>
                <div class="menu-divider"></div>
                <div class="menu-group markers-group">
                    <button class="menu-btn tool-btn" data-tool="spawn-def" title="Defence Spawn&#10;ÏàòÎπÑÌåÄ ÏãúÏûë ÏúÑÏπò (10√ó10m)" style="color:#27ae60;"><i class="fa-solid fa-shield-halved"></i></button>
                    <button class="menu-btn tool-btn" data-tool="spawn-off" title="Offence Spawn&#10;Í≥µÍ≤©ÌåÄ ÏãúÏûë ÏúÑÏπò (10√ó10m)" style="color:#e74c3c;"><i class="fa-solid fa-crosshairs"></i></button>
                    <button class="menu-btn tool-btn" data-tool="objective" title="Objective Point&#10;Ï†êÎ†π Î™©Ìëú ÏßÄÏ†ê (16√ó16m)" style="color:#f39c12;"><i class="fa-solid fa-flag"></i></button>
                </div>
                <div class="menu-divider"></div>
                <div class="menu-group zoom-group">
                    <button id="zoomOut" class="menu-btn" title="Ï∂ïÏÜå"><i class="fa-solid fa-minus"></i></button>
                    <span id="zoomLevel" class="zoom-display">100%</span>
                    <button id="zoomIn" class="menu-btn" title="ÌôïÎåÄ"><i class="fa-solid fa-plus"></i></button>
                    <button id="zoomFit" class="menu-btn" title="ÎßûÏ∂îÍ∏∞"><i class="fa-solid fa-expand"></i></button>
                </div>
            </nav>
            <div class="menu-right">
                <label class="toggle-label">
                    <input type="checkbox" id="gridToggle" checked>
                    <span>Í∑∏Î¶¨Îìú</span>
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="snapToggle" checked>
                    <span>Ïä§ÎÉÖ</span>
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="diagSnapToggle">
                    <span>45¬∞</span>
                </label>
                <select id="gridSizeSelect" class="mini-select" title="1Ïπ∏ = 1m">
                    <option value="32" selected>1m</option>
                    <option value="64">2m</option>
                    <option value="16">0.5m</option>
                </select>
            </div>
            <input type="file" id="fileInput" accept=".json,.lvl" style="display:none">
        </header>

        <main class="workspace">
            <!-- ÏôºÏ™Ω ÎèÑÍµ¨ Ìå®ÎÑê -->
            <aside class="tool-panel">
                <div class="tool-section">
                    <div class="tool-section-title">SIMULATION</div>
                    <button id="simPreviewBtn" class="tool-btn-wide" title="Í≤ΩÎ°ú ÎØ∏Î¶¨Î≥¥Í∏∞" style="background:#3d3a5a;">
                        <i class="fa-solid fa-route" style="color:#a29bfe"></i>
                        <span>Í≤ΩÎ°ú ÎØ∏Î¶¨Î≥¥Í∏∞</span>
                    </button>
                    <button id="simStartBtn" class="tool-btn-wide" title="ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏãúÏûë" style="background:#2d4a5a; margin-top:4px;">
                        <i class="fa-solid fa-play" style="color:#4ecdc4"></i>
                        <span>ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏãúÏûë</span>
                    </button>
                    <button id="simStopBtn" class="tool-btn-wide" title="ÏãúÎÆ¨Î†àÏù¥ÏÖò Ï†ïÏßÄ" style="background:#5a2d2d; margin-top:4px; display:none;">
                        <i class="fa-solid fa-stop" style="color:#e74c3c"></i>
                        <span>Ï†ïÏßÄ</span>
                    </button>
                    <button id="simPinBtn" class="tool-btn-wide" title="ÌïÄ ÍΩÇÍ∏∞ - ÌÅ¥Î¶≠ ÏúÑÏπòÎ°ú Î™®Îì† ÏóêÏù¥Ï†ÑÌä∏ Ïù¥Îèô" style="background:#5a4a2d; margin-top:4px; display:none;">
                        <i class="fa-solid fa-map-pin" style="color:#f39c12"></i>
                        <span>ÌïÄ ÍΩÇÍ∏∞ Î™®Îìú</span>
                    </button>
                    <div id="simStatus" style="font-size:10px;color:#888;margin-top:4px;padding:0 4px;">
                        Defence/Offence Î∞∞Ïπò ÌõÑ ÏãúÏûë
                    </div>
                </div>

                <input type="file" id="refImageInput" accept="image/*" style="display:none">

                <div class="tool-section" style="border-top: 1px solid #4a9; padding-top: 8px;">
                    <div class="tool-section-title" style="color:#4a9;">üêç PROCEDURAL GEN</div>
                    <div style="display:flex; gap:4px;">
                        <button class="tool-btn-wide" onclick="app.showProceduralDialog()" title="Í∑úÏπô Í∏∞Î∞ò Îßµ ÏÉùÏÑ±" style="background:#2d5a3d; flex:1;">
                            <i class="fa-solid fa-wand-magic-sparkles" style="color:#4ecdc4"></i>
                            <span>Îßµ ÏÉùÏÑ±</span>
                        </button>
                        <button onclick="app.regenerateMap()" title="ÏÉà ÏãúÎìúÎ°ú Ïû¨ÏÉùÏÑ±" style="background:#2d5a3d; border:none; color:#4ecdc4; padding:8px 12px; border-radius:6px; cursor:pointer;">
                            <i class="fa-solid fa-rotate"></i>
                        </button>
                    </div>
                    <div id="pyStatus" style="font-size:10px;color:#4a9;margin-top:4px;padding:0 4px;">
                        Python ÏÑúÎ≤Ñ: localhost:3003
                    </div>
                </div>

                <div class="tool-section" style="border-top: 1px solid #4a9; padding-top: 8px;">
                    <div class="tool-section-title" style="color:#4ecdc4;">LAYOUT</div>
                    <button id="editLayoutBtnMain" onclick="app.openLayoutEditor()" style="display:none; width:100%; padding:10px; background:linear-gradient(135deg, #e67e22, #d35400); border:none; color:#fff; border-radius:6px; cursor:pointer; font-size:12px; font-weight:bold;">
                        <i class="fa-solid fa-pen-to-square"></i> Î†àÏù¥ÏïÑÏõÉ ÏàòÏ†ï
                    </button>
                </div>

                <div class="tool-section" style="border-top: 1px solid #666; padding-top: 8px;">
                    <div class="tool-section-title" style="color:#888;">POST PROCESS</div>
                    <div style="display:flex; gap:4px; flex-wrap:wrap; margin-bottom:4px;">
                        <button onclick="app.generateWallsForExisting()" title="Í∏∞Ï°¥ Î†àÎ≤®Ïóê Ïô∏Í≥Ω Î≤Ω ÏÉùÏÑ±" style="flex:1; min-width:70px; padding:6px 8px; background:#3d4a5a; border:none; color:#ccc; border-radius:4px; cursor:pointer; font-size:11px;">
                            <i class="fa-solid fa-border-all"></i> Î≤Ω ÏÉùÏÑ±
                        </button>
                        <button onclick="app.removeAllWalls()" title="Î™®Îì† Î≤Ω ÏÇ≠Ï†ú" style="min-width:50px; padding:6px 8px; background:#5a3d3d; border:none; color:#ccc; border-radius:4px; cursor:pointer; font-size:11px;">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                    <div style="display:flex; gap:4px; flex-wrap:wrap;">
                        <button onclick="app.generateCliffForExisting()" title="Í∏∞Ï°¥ Î†àÎ≤®Ïóê Ïô∏Í≥Ω Ï†àÎ≤Ω ÏÉùÏÑ±" style="flex:1; min-width:70px; padding:6px 8px; background:#3d4a5a; border:none; color:#ccc; border-radius:4px; cursor:pointer; font-size:11px;">
                            <i class="fa-solid fa-mountain"></i> Ï†àÎ≤Ω ÏÉùÏÑ±
                        </button>
                        <button onclick="app.removeAllCliffs()" title="Î™®Îì† Ï†àÎ≤Ω ÏÇ≠Ï†ú" style="min-width:50px; padding:6px 8px; background:#5a3d3d; border:none; color:#ccc; border-radius:4px; cursor:pointer; font-size:11px;">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </div>

                <div class="tool-section objects-section">
                    <div class="tool-section-title">
                        OBJECTS <span id="objectCount" class="badge">0</span>
                    </div>
                    <div class="objects-list-container">
                        <ul id="objectsList" class="objects-ul"></ul>
                    </div>
                </div>
            </aside>

            <!-- Ï∫îÎ≤ÑÏä§ ÏòÅÏó≠ -->
            <div class="canvas-area">
                <div class="canvas-container" id="canvasContainer">
                    <canvas id="gridCanvas"></canvas>
                    <canvas id="mainCanvas"></canvas>
                    <canvas id="uiCanvas"></canvas>
                </div>
                <div class="canvas-info">
                    <span id="coordsDisplay">0m, 0m</span>
                    <span id="objectInfo">-</span>
                    <span id="hintText">V: ÏÑ†ÌÉù | P: Îã§Í∞ÅÌòï | S: Ïä§ÌîåÎùºÏù∏ | Enter: ÏôÑÏÑ± | Esc: Ï∑®ÏÜå</span>
                </div>
            </div>

            <!-- Ïò§Î•∏Ï™Ω ÏÜçÏÑ± Ìå®ÎÑê -->
            <aside class="props-panel">
                <div class="props-section">
                    <div class="props-header">
                        <span>PROPERTIES</span>
                    </div>
                    <div id="propsContent" class="props-content">
                        <div class="props-empty">
                            <i class="fa-solid fa-cube"></i>
                            <p>Ïò§Î∏åÏ†ùÌä∏Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
                        </div>
                    </div>
                </div>

                <div class="props-section">
                    <div class="props-header">
                        <span>HEIGHT (ÎÜíÏù¥)</span>
                    </div>
                    <div class="props-content">
                        <div class="height-control">
                            <label>Î∞îÎã• ÎÜíÏù¥</label>
                            <div class="height-input-row">
                                <input type="number" id="floorHeight" value="0" step="0.5" min="-10" max="50">
                                <span>m</span>
                            </div>
                            <div class="height-presets">
                                <button class="height-btn" data-height="0">0m</button>
                                <button class="height-btn" data-height="1">1m</button>
                                <button class="height-btn" data-height="2">2m</button>
                                <button class="height-btn" data-height="3">3m</button>
                                <button class="height-btn" data-height="-1">-1m</button>
                            </div>
                        </div>
                    </div>
                </div>

            </aside>
        </main>
    </div>

    <!-- 3D Î∑∞Ïñ¥ Î™®Îã¨ -->
    <div id="viewer3dModal" class="modal-overlay" style="display:none">
        <div class="modal-3d">
            <div class="modal-3d-header">
                <span>3D VIEW</span>
                <div class="modal-3d-controls">
                    <button id="walkModeBtn">üö∂ ÏõåÌÅ¨ Î™®Îìú</button>
                    <label><input type="checkbox" id="wireframeToggle"> ÏôÄÏù¥Ïñ¥ÌîÑÎ†àÏûÑ</label>
                    <label><input type="checkbox" id="gridToggle3d" checked> Í∑∏Î¶¨Îìú</label>
                    <button id="resetCamera3d">Ïπ¥Î©îÎùº Î¶¨ÏÖã</button>
                    <button id="close3dBtn"><i class="fa-solid fa-xmark"></i></button>
                </div>
            </div>
            <div id="viewer3dContainer"></div>
            <div class="modal-3d-info">
                <span id="viewerInfoText">ÎßàÏö∞Ïä§ ÎìúÎûòÍ∑∏: ÌöåÏ†Ñ | Ïä§ÌÅ¨Î°§: Ï§å | Ïö∞ÌÅ¥Î¶≠ ÎìúÎûòÍ∑∏: Ïù¥Îèô</span>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="level-rules.js"></script>
    <script src="procedural.js"></script>
    <script src="app.js"></script>
    <script src="viewer3d.js"></script>

    <!-- Procedural ÌååÎùºÎØ∏ÌÑ∞ Î™®Îã¨ -->
    <div id="proceduralModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); z-index:9999; justify-content:center; align-items:center;">
        <div style="background:#1a1a2e; border-radius:12px; padding:24px; width:1000px; max-height:95vh; overflow:hidden; border:1px solid #4a9; display:flex; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <h3 style="color:#4ecdc4; margin:0;">Îßµ ÏÉùÏÑ± ÏÑ§Ï†ï</h3>
                <button onclick="app.closeProceduralDialog()" style="background:none; border:none; color:#888; font-size:20px; cursor:pointer;">&times;</button>
            </div>
            
            <div style="display:flex; gap:20px; flex:1; overflow:hidden;">
                <!-- ÏôºÏ™Ω: ÌîÑÎ¶¨Î∑∞ -->
                <div style="width:480px; flex-shrink:0; display:flex; flex-direction:column;">
                    <div style="color:#888; font-size:12px; margin-bottom:8px;">ÌîÑÎ¶¨Î∑∞ (Ìè¨Ïù∏Ìä∏ ÎìúÎûòÍ∑∏ Í∞ÄÎä•)</div>
                    <canvas id="previewCanvas" width="460" height="520" style="background:#0a0a15; border-radius:8px; border:1px solid #333; cursor:crosshair;"></canvas>
                    <div style="display:flex; gap:8px; margin-top:8px;">
                        <button onclick="app.randomizePreview()" style="flex:1; padding:6px; background:#2d4a5a; border:none; color:#fff; border-radius:4px; cursor:pointer; font-size:11px;">ÎûúÎç§ Î∞∞Ïπò</button>
                        <button onclick="app.resetPreview()" style="flex:1; padding:6px; background:#4a2d2d; border:none; color:#fff; border-radius:4px; cursor:pointer; font-size:11px;">Ï¥àÍ∏∞Ìôî</button>
                    </div>
                    
                    <!-- ÎûëÎç∞Î∑∞ Ìè¨Ïù∏Ìä∏ ÌÜ†Í∏Ä -->
                    <div style="background:#1a1a2e; padding:8px; border-radius:6px; margin-top:10px;">
                        <div style="color:#888; font-size:11px; margin-bottom:6px;">ÎûëÎç∞Î∑∞ Ìè¨Ïù∏Ìä∏</div>
                        <div style="display:flex; gap:12px; flex-wrap:wrap;">
                            <label style="display:flex; align-items:center; gap:4px; color:#1abc9c; font-size:11px; cursor:pointer;">
                                <input type="checkbox" id="enableSideA" checked onchange="app.renderPreview()">
                                <span>AÂÅ¥</span>
                            </label>
                            <label style="display:flex; align-items:center; gap:4px; color:#1abc9c; font-size:11px; cursor:pointer;">
                                <input type="checkbox" id="enableSideB" checked onchange="app.renderPreview()">
                                <span>BÂÅ¥</span>
                            </label>
                            <label style="display:flex; align-items:center; gap:4px; color:#e67e22; font-size:11px; cursor:pointer;">
                                <input type="checkbox" id="enableLobbyA" checked onchange="app.renderPreview()">
                                <span>AÂÖ•</span>
                            </label>
                            <label style="display:flex; align-items:center; gap:4px; color:#e67e22; font-size:11px; cursor:pointer;">
                                <input type="checkbox" id="enableLobbyB" checked onchange="app.renderPreview()">
                                <span>BÂÖ•</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Ïó∞Í≤∞ÏÑ† Ï†úÏñ¥ -->
                    <div style="background:#1a1a2e; padding:8px; border-radius:6px; margin-top:8px;">
                        <div style="color:#888; font-size:11px; margin-bottom:4px;">Ïó∞Í≤∞ÏÑ† (ÎèôÏÑ†)</div>
                        <div style="color:#666; font-size:9px; line-height:1.4;">
                            ‚Ä¢ <b>Shift+ÎìúÎûòÍ∑∏</b>: ÎÖ∏Îìú‚ÜíÎÖ∏Îìú Ïó∞Í≤∞<br>
                            ‚Ä¢ <b>√ó ÌÅ¥Î¶≠</b>: Ïó∞Í≤∞ Ìï¥Ï†ú
                        </div>
                        <button onclick="app.resetConnections()" style="margin-top:6px; padding:4px 8px; background:#4a2d2d; border:none; color:#fff; border-radius:4px; cursor:pointer; font-size:10px; width:100%;">Ïó∞Í≤∞ Ï¥àÍ∏∞Ìôî</button>
                    </div>
                    
                    <div style="color:#666; font-size:10px; margin-top:8px; line-height:1.6;">
                        <span style="color:#e74c3c;">‚óè</span> ATK &nbsp;
                        <span style="color:#3498db;">‚óè</span> DEF &nbsp;
                        <span style="color:#f1c40f;">‚óè</span> SITE &nbsp;
                        <span style="color:#9b59b6;">‚óè</span> MID
                    </div>
                </div>
                
                <!-- Ïò§Î•∏Ï™Ω: ÏÑ§Ï†ï Ìå®ÎÑê -->
                <div style="flex:1; overflow-y:auto; padding-right:8px;">
                    <!-- Ï∫îÎ≤ÑÏä§ ÎπÑÏö∞Í∏∞ ÏòµÏÖò -->
                    <div style="background:#2d2d44; padding:12px; border-radius:8px; margin-bottom:16px;">
                        <label style="display:flex; align-items:center; gap:8px; color:#fff; cursor:pointer;">
                            <input type="checkbox" id="clearCanvas" checked style="width:18px; height:18px;">
                            <span>Ï∫îÎ≤ÑÏä§ ÎπÑÏö∞Í≥† ÏÉùÏÑ±</span>
                        </label>
                    </div>

            <!-- ÏÇ¨Ïù¥Ìä∏ Í∞úÏàò -->
            <div style="background:#2d2d44; padding:12px; border-radius:8px; margin-bottom:16px;">
                <div style="color:#4ecdc4; font-weight:bold; margin-bottom:8px;">ÏÇ¨Ïù¥Ìä∏ Í∞úÏàò</div>
                <div style="display:flex; gap:8px;">
                    <label style="flex:1; display:flex; align-items:center; gap:6px; color:#fff; cursor:pointer; padding:8px; background:#1a1a2e; border-radius:6px;">
                        <input type="radio" name="siteCount" value="1">
                        <span>1Í∞ú</span>
                    </label>
                    <label style="flex:1; display:flex; align-items:center; gap:6px; color:#fff; cursor:pointer; padding:8px; background:#1a1a2e; border-radius:6px;">
                        <input type="radio" name="siteCount" value="2" checked>
                        <span>2Í∞ú</span>
                    </label>
                    <label style="flex:1; display:flex; align-items:center; gap:6px; color:#fff; cursor:pointer; padding:8px; background:#1a1a2e; border-radius:6px;">
                        <input type="radio" name="siteCount" value="3">
                        <span>3Í∞ú</span>
                    </label>
                </div>
            </div>

            <!-- ÏïåÍ≥†Î¶¨Ï¶ò ÏÑ†ÌÉù -->
            <div style="background:#2d2d44; padding:12px; border-radius:8px; margin-bottom:16px;">
                <div style="color:#4ecdc4; font-weight:bold; margin-bottom:8px;">ÏïåÍ≥†Î¶¨Ï¶ò</div>
                <div style="display:flex; gap:6px; flex-wrap:wrap;">
                    <label style="flex:1; min-width:80px; display:flex; align-items:center; gap:6px; color:#fff; cursor:pointer; padding:8px; background:#1a1a2e; border-radius:6px;">
                        <input type="radio" name="algorithm" value="v2" checked>
                        <span>Í∑∏Î¶¨Îìú</span>
                    </label>
                    <label style="flex:1; min-width:80px; display:flex; align-items:center; gap:6px; color:#fff; cursor:pointer; padding:8px; background:#1a1a2e; border-radius:6px;">
                        <input type="radio" name="algorithm" value="v3">
                        <span>Ïú†Í∏∞Ï†Å</span>
                    </label>
                    <label style="flex:1; min-width:80px; display:flex; align-items:center; gap:6px; color:#fff; cursor:pointer; padding:8px; background:#1a1a2e; border-radius:6px; border:1px solid #4ecdc4;">
                        <input type="radio" name="algorithm" value="v4">
                        <span>Î≤°ÌÑ∞</span>
                    </label>
                </div>
                <div style="font-size:10px; color:#888; margin-top:6px;">
                    Î≤°ÌÑ∞: ÏßÑÏßú ÎåÄÍ∞ÅÏÑ†/Î∂àÍ∑úÏπô Îã§Í∞ÅÌòï
                </div>
            </div>

            <!-- ÏÇ¨Ïù¥Ìä∏ ÌÅ¨Í∏∞ -->
            <div class="param-group" style="margin-bottom:16px;">
                <div style="color:#4ecdc4; font-weight:bold; margin-bottom:8px;">ÌÅ¨Í∏∞ ÏÑ§Ï†ï</div>
                <div style="display:grid; gap:8px;">
                    <div style="background:#2d2d44; padding:10px; border-radius:6px;">
                        <label style="color:#aaa; font-size:12px;">ÏÇ¨Ïù¥Ìä∏ ÌÅ¨Í∏∞ (m)</label>
                        <div style="display:flex; gap:8px; margin-top:4px;">
                            <input type="number" id="siteSizeMin" value="18" min="12" max="40" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                            <span style="color:#666;">~</span>
                            <input type="number" id="siteSizeMax" value="26" min="12" max="50" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                        </div>
                    </div>
                    <div style="background:#2d2d44; padding:10px; border-radius:6px;">
                        <label style="color:#aaa; font-size:12px;">Î∞© ÌÅ¨Í∏∞ - MID/LOBBY Îì± (m)</label>
                        <div style="display:flex; gap:8px; margin-top:4px;">
                            <input type="number" id="roomSizeMin" value="14" min="8" max="30" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                            <span style="color:#666;">~</span>
                            <input type="number" id="roomSizeMax" value="22" min="8" max="40" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÌÉÄÏù¥Î∞ç -->
            <div class="param-group" style="margin-bottom:16px;">
                <div style="color:#4ecdc4; font-weight:bold; margin-bottom:8px;">ÌÉÄÏù¥Î∞ç Î∞∏Îü∞Ïä§</div>
                <div style="display:grid; gap:8px;">
                    <div style="background:#2d2d44; padding:10px; border-radius:6px;">
                        <label style="color:#aaa; font-size:12px;">Í≥µÍ≤©‚ÜíÏÇ¨Ïù¥Ìä∏ (ÌÉÄÏùº)</label>
                        <div style="display:flex; gap:8px; margin-top:4px;">
                            <input type="number" id="atkToSiteMin" value="60" min="20" max="120" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                            <span style="color:#666;">~</span>
                            <input type="number" id="atkToSiteMax" value="90" min="20" max="120" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                        </div>
                    </div>
                    <div style="background:#2d2d44; padding:10px; border-radius:6px;">
                        <label style="color:#aaa; font-size:12px;">ÏàòÎπÑ‚ÜíÏÇ¨Ïù¥Ìä∏ (ÌÉÄÏùº)</label>
                        <div style="display:flex; gap:8px; margin-top:4px;">
                            <input type="number" id="defToSiteMin" value="40" min="20" max="100" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                            <span style="color:#666;">~</span>
                            <input type="number" id="defToSiteMax" value="70" min="20" max="100" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÌÜµÎ°ú -->
            <div class="param-group" style="margin-bottom:16px;">
                <div style="color:#4ecdc4; font-weight:bold; margin-bottom:8px;">ÌÜµÎ°ú</div>
                <div style="display:grid; gap:8px;">
                    <div style="background:#2d2d44; padding:10px; border-radius:6px;">
                        <label style="color:#aaa; font-size:12px;">ÏµúÎåÄ ÏßÅÏÑ† Í∏∏Ïù¥ (m)</label>
                        <input type="range" id="maxStraight" min="10" max="40" value="25" style="width:100%; margin-top:4px;">
                        <span id="maxStraightVal" style="color:#4ecdc4;">25m</span>
                    </div>
                    <div style="background:#2d2d44; padding:10px; border-radius:6px;">
                        <label style="color:#aaa; font-size:12px;">ÌÜµÎ°ú ÎÑàÎπÑ (m)</label>
                        <div style="display:flex; gap:8px; margin-top:4px;">
                            <input type="number" id="corridorWidthMin" value="4" min="3" max="10" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                            <span style="color:#666;">~</span>
                            <input type="number" id="corridorWidthMax" value="7" min="3" max="10" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÏãúÏïºÏÑ† -->
            <div class="param-group" style="margin-bottom:16px;">
                <div style="color:#4ecdc4; font-weight:bold; margin-bottom:8px;">ÏãúÏïºÏÑ†</div>
                <div style="background:#2d2d44; padding:10px; border-radius:6px;">
                    <label style="color:#aaa; font-size:12px;">ÏµúÎåÄ ÏãúÏïºÏÑ† (m)</label>
                    <input type="range" id="maxSightline" min="20" max="80" value="50" style="width:100%; margin-top:4px;">
                    <span id="maxSightlineVal" style="color:#4ecdc4;">50m</span>
                </div>
            </div>

            <!-- Ïª§Î≤Ñ -->
            <div class="param-group" style="margin-bottom:16px;">
                <div style="color:#4ecdc4; font-weight:bold; margin-bottom:8px;">ÏóÑÌèêÎ¨º</div>
                <div style="display:grid; gap:8px;">
                    <div style="background:#2d2d44; padding:10px; border-radius:6px;">
                        <label style="color:#aaa; font-size:12px;">Ïª§Î≤Ñ Í∞ÑÍ≤© (m)</label>
                        <div style="display:flex; gap:8px; margin-top:4px;">
                            <input type="number" id="coverSpacingMin" value="8" min="4" max="20" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                            <span style="color:#666;">~</span>
                            <input type="number" id="coverSpacingMax" value="15" min="4" max="20" style="width:60px; background:#1a1a2e; border:1px solid #444; color:#fff; padding:4px; border-radius:4px;">
                        </div>
                    </div>
                    <div style="background:#2d2d44; padding:10px; border-radius:6px;">
                        <label style="color:#aaa; font-size:12px;">ÏµúÎåÄ ÎÖ∏Ï∂ú Í±∞Î¶¨ (m)</label>
                        <input type="range" id="exposedMax" min="6" max="20" value="12" style="width:100%; margin-top:4px;">
                        <span id="exposedMaxVal" style="color:#4ecdc4;">12m</span>
                    </div>
                </div>
            </div>

            <!-- Î≤Ω ÏÉùÏÑ± ÏòµÏÖò -->
            <div class="param-group" style="margin-bottom:16px;">
                <div style="color:#4ecdc4; font-weight:bold; margin-bottom:8px;">Î≤Ω ÏÉùÏÑ±</div>
                <div style="background:#2d2d44; padding:10px; border-radius:6px;">
                    <label style="display:flex; align-items:center; gap:8px; color:#ccc; cursor:pointer; margin-bottom:6px;">
                        <input type="checkbox" id="enablePerimeterWalls" checked style="width:16px; height:16px;">
                        <span>Ïô∏Í≥Ω Î≤Ω ÏÉùÏÑ±</span>
                    </label>
                    <label style="display:flex; align-items:center; gap:8px; color:#ccc; cursor:pointer;">
                        <input type="checkbox" id="enableGapWalls" checked style="width:16px; height:16px;">
                        <span>ÎÇ¥Î∂Ä Ìãà Î≤Ω ÏÉùÏÑ±</span>
                    </label>
                </div>
            </div>

                    <!-- Î≤ÑÌäºÎì§ -->
                    <button onclick="app.generateWithParams()" style="width:100%; padding:14px; background:linear-gradient(135deg, #4ecdc4, #44a08d); border:none; color:#fff; font-size:16px; font-weight:bold; border-radius:8px; cursor:pointer; margin-bottom:10px;">
                        Îßµ ÏÉùÏÑ±
                    </button>
                    <button id="editLayoutBtn" onclick="app.openLayoutEditor()" style="display:none; width:100%; padding:12px; background:linear-gradient(135deg, #e67e22, #d35400); border:none; color:#fff; font-size:14px; font-weight:bold; border-radius:8px; cursor:pointer;">
                        Î†àÏù¥ÏïÑÏõÉ ÏàòÏ†ï
                    </button>
                </div><!-- Ïò§Î•∏Ï™Ω ÏÑ§Ï†ï Ìå®ÎÑê ÎÅù -->
            </div><!-- flex Ïª®ÌÖåÏù¥ÎÑà ÎÅù -->
        </div>
    </div>

    <!-- ÌíÄÏä§ÌÅ¨Î¶∞ Í≥†Í∏â ÏóêÎîîÌÑ∞ Î™®Îã¨ -->
    <div id="advancedEditorModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.9); z-index:10000;">
        <div style="width:100%; height:100%; display:flex; flex-direction:column; padding:16px; box-sizing:border-box;">
            <!-- Ìó§Îçî -->
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                <h2 style="color:#4ecdc4; margin:0; font-size:20px;">Í≥†Í∏â Î†àÏù¥ÏïÑÏõÉ Ìé∏ÏßëÍ∏∞</h2>
                <div style="display:flex; gap:12px; align-items:center;">
                    <button onclick="app.applyAdvancedLayout()" style="padding:10px 24px; background:linear-gradient(135deg, #4ecdc4, #44a08d); border:none; color:#fff; font-weight:bold; border-radius:6px; cursor:pointer;">
                        Ï†ÅÏö© ÌõÑ ÏÉùÏÑ±
                    </button>
                    <button onclick="app.closeAdvancedEditor()" style="background:none; border:none; color:#888; font-size:28px; cursor:pointer; padding:0 8px;">&times;</button>
                </div>
            </div>
            
            <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
            <div style="flex:1; display:flex; gap:16px; overflow:hidden;">
                <!-- Ï∫îÎ≤ÑÏä§ ÏòÅÏó≠ -->
                <div style="flex:1; background:#0a0a15; border-radius:12px; border:1px solid #333; position:relative; overflow:hidden;">
                    <canvas id="advancedPreviewCanvas" style="width:100%; height:100%;"></canvas>
                    
                    <!-- Ï∫îÎ≤ÑÏä§ Ìà¥Î∞î -->
                    <div style="position:absolute; top:12px; left:12px; display:flex; gap:8px;">
                        <button onclick="app.advLoadFromCanvas()" style="padding:8px 16px; background:#5a4a2d; border:none; color:#fff; border-radius:4px; cursor:pointer; font-size:12px;">ÌòÑÏû¨ Îßµ Î∂àÎü¨Ïò§Í∏∞</button>
                        <button onclick="app.advRandomize()" style="padding:8px 16px; background:#2d4a5a; border:none; color:#fff; border-radius:4px; cursor:pointer; font-size:12px;">ÎûúÎç§ Î∞∞Ïπò</button>
                        <button onclick="app.advReset()" style="padding:8px 16px; background:#4a2d2d; border:none; color:#fff; border-radius:4px; cursor:pointer; font-size:12px;">Ï¥àÍ∏∞Ìôî</button>
                        <button onclick="app.advAddNode()" style="padding:8px 16px; background:#3d4a3d; border:none; color:#fff; border-radius:4px; cursor:pointer; font-size:12px;">+ ÎÖ∏Îìú Ï∂îÍ∞Ä</button>
                    </div>
                    
                    <!-- Î≤îÎ°Ä -->
                    <div style="position:absolute; bottom:12px; left:12px; background:rgba(0,0,0,0.7); padding:8px 12px; border-radius:6px; font-size:11px; color:#aaa;">
                        <span style="color:#e74c3c;">‚óè</span> ATK &nbsp;
                        <span style="color:#3498db;">‚óè</span> DEF &nbsp;
                        <span style="color:#f1c40f;">‚óè</span> SITE &nbsp;
                        <span style="color:#9b59b6;">‚óè</span> MID &nbsp;
                        <span style="color:#e67e22;">‚óè</span> LOBBY &nbsp;
                        <span style="color:#1abc9c;">‚óè</span> SIDE
                    </div>
                    
                    <!-- ÎèÑÏõÄÎßê -->
                    <div style="position:absolute; bottom:12px; right:12px; background:rgba(0,0,0,0.7); padding:8px 12px; border-radius:6px; font-size:11px; color:#666;">
                        ÎìúÎûòÍ∑∏: Ïù¥Îèô | ÌÅ¥Î¶≠: ÏÑ†ÌÉù | Shift+ÎìúÎûòÍ∑∏: Ïó∞Í≤∞ | Del: ÏÇ≠Ï†ú
                    </div>
                </div>
                
                <!-- Ïö∞Ï∏° ÏÑ§Ï†ï Ìå®ÎÑê -->
                <div style="width:320px; background:#1a1a2e; border-radius:12px; border:1px solid #333; padding:16px; overflow-y:auto;">
                    <!-- ÏÑ†ÌÉùÎêú ÎÖ∏Îìú Ï†ïÎ≥¥ -->
                    <div id="advNodePanel" style="display:none;">
                        <h3 style="color:#4ecdc4; margin:0 0 16px 0; font-size:16px;">ÎÖ∏Îìú ÏÑ§Ï†ï</h3>
                        
                        <div style="margin-bottom:16px;">
                            <label style="color:#888; font-size:12px; display:block; margin-bottom:4px;">Ïù¥Î¶Ñ</label>
                            <input type="text" id="advNodeName" style="width:100%; background:#0a0a15; border:1px solid #444; color:#fff; padding:8px; border-radius:4px; box-sizing:border-box;">
                        </div>
                        
                        <div style="margin-bottom:16px;">
                            <label style="color:#888; font-size:12px; display:block; margin-bottom:4px;">ÌÉÄÏûÖ</label>
                            <select id="advNodeType" style="width:100%; background:#0a0a15; border:1px solid #444; color:#fff; padding:8px; border-radius:4px;">
                                <option value="SITE">SITE (Ìè≠ÌÉÑÏÑ§Ïπò ÏßÄÏ†ê)</option>
                                <option value="SPAWN_ATK">SPAWN_ATK (Í≥µÍ≤©ÌåÄ Ïä§Ìè∞)</option>
                                <option value="SPAWN_DEF">SPAWN_DEF (ÏàòÎπÑÌåÄ Ïä§Ìè∞)</option>
                                <option value="MID">MID (Ï§ëÏïô)</option>
                                <option value="MAIN">MAIN (Ï£ºÎèôÏÑ†)</option>
                                <option value="LOBBY">LOBBY (ÏûÖÍµ¨)</option>
                                <option value="SIDE">SIDE (Ï∏°Î©¥)</option>
                                <option value="CHOKE">CHOKE (Ï¢ÅÏùÄ ÌÜµÎ°ú)</option>
                                <option value="CONNECTOR">CONNECTOR (Ïó∞Í≤∞ ÌÜµÎ°ú)</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom:16px;">
                            <label style="color:#888; font-size:12px; display:block; margin-bottom:4px;">ÌÅ¨Í∏∞ (m)</label>
                            <div style="display:flex; gap:8px;">
                                <div style="flex:1;">
                                    <label style="color:#666; font-size:10px;">Í∞ÄÎ°ú</label>
                                    <input type="number" id="advNodeWidth" min="8" max="50" value="20" style="width:100%; background:#0a0a15; border:1px solid #444; color:#fff; padding:6px; border-radius:4px; box-sizing:border-box;">
                                </div>
                                <div style="flex:1;">
                                    <label style="color:#666; font-size:10px;">ÏÑ∏Î°ú</label>
                                    <input type="number" id="advNodeHeight" min="8" max="50" value="20" style="width:100%; background:#0a0a15; border:1px solid #444; color:#fff; padding:6px; border-radius:4px; box-sizing:border-box;">
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom:16px;">
                            <label style="color:#888; font-size:12px; display:block; margin-bottom:4px;">ÎÜíÏù¥ (m)</label>
                            <input type="number" id="advNodeFloorHeight" min="-10" max="10" value="0" step="0.5" style="width:100%; background:#0a0a15; border:1px solid #444; color:#fff; padding:8px; border-radius:4px; box-sizing:border-box;">
                        </div>
                        
                        <div style="margin-bottom:16px;">
                            <label style="color:#888; font-size:12px; display:block; margin-bottom:8px;">Ïó∞Í≤∞Îêú ÎÖ∏Îìú</label>
                            <div id="advNodeConnections" style="background:#0a0a15; padding:8px; border-radius:4px; min-height:60px; font-size:12px; color:#aaa;">
                                (Ïó∞Í≤∞ ÏóÜÏùå)
                            </div>
                        </div>
                        
                        <button onclick="app.advDeleteNode()" style="width:100%; padding:10px; background:#5a2d2d; border:none; color:#fff; border-radius:6px; cursor:pointer; margin-top:8px;">
                            ÎÖ∏Îìú ÏÇ≠Ï†ú
                        </button>
                    </div>
                    
                    <!-- ÏÑ†ÌÉù Ïïà ÎêêÏùÑ Îïå -->
                    <div id="advNoSelection" style="color:#666; text-align:center; padding:40px 0;">
                        <div style="font-size:48px; margin-bottom:16px;">üëÜ</div>
                        <div>ÎÖ∏ÎìúÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                        <div style="font-size:12px; margin-top:8px;">ÎòêÎäî '+ ÎÖ∏Îìú Ï∂îÍ∞Ä' Î≤ÑÌäºÏúºÎ°ú<br>ÏÉà ÎÖ∏ÎìúÎ•º ÎßåÎìúÏÑ∏Ïöî</div>
                    </div>
                    
                    <!-- Ï†ÑÏ≤¥ ÏÑ§Ï†ï -->
                    <div style="border-top:1px solid #333; margin-top:20px; padding-top:16px;">
                        <h4 style="color:#888; margin:0 0 12px 0; font-size:13px;">Ï†ÑÏ≤¥ Îßµ ÏÑ§Ï†ï</h4>
                        
                        <div style="margin-bottom:12px;">
                            <label style="color:#666; font-size:11px; display:block; margin-bottom:4px;">ÏÇ¨Ïù¥Ìä∏ Í∞úÏàò</label>
                            <div style="display:flex; gap:6px;">
                                <label style="flex:1; text-align:center; padding:6px; background:#0a0a15; border-radius:4px; cursor:pointer; color:#aaa; font-size:12px;">
                                    <input type="radio" name="advSiteCount" value="1" style="display:none;">
                                    <span>1Í∞ú</span>
                                </label>
                                <label style="flex:1; text-align:center; padding:6px; background:#0a0a15; border-radius:4px; cursor:pointer; color:#aaa; font-size:12px;">
                                    <input type="radio" name="advSiteCount" value="2" checked style="display:none;">
                                    <span>2Í∞ú</span>
                                </label>
                                <label style="flex:1; text-align:center; padding:6px; background:#0a0a15; border-radius:4px; cursor:pointer; color:#aaa; font-size:12px;">
                                    <input type="radio" name="advSiteCount" value="3" style="display:none;">
                                    <span>3Í∞ú</span>
                                </label>
                            </div>
                        </div>
                        
                        <div style="margin-bottom:12px;">
                            <label style="color:#666; font-size:11px; display:block; margin-bottom:4px;">ÌÜµÎ°ú Ìè≠ (m)</label>
                            <input type="number" id="advCorridorWidth" min="4" max="12" value="6" style="width:100%; background:#0a0a15; border:1px solid #444; color:#fff; padding:6px; border-radius:4px; box-sizing:border-box; font-size:12px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Î†àÏù¥ÏïÑÏõÉ Ìé∏Ïßë Î™®Îìú ÏÉÅÎã® Î∞î -->
    <div id="layoutEditBar" style="display:none; position:fixed; top:0; left:180px; right:0; height:50px; background:rgba(30,40,50,0.95); border-bottom:2px solid #4ecdc4; z-index:100; align-items:center; padding:0 16px; gap:12px;">
        <span style="color:#4ecdc4; font-weight:bold;">Î†àÏù¥ÏïÑÏõÉ Ìé∏Ïßë Î™®Îìú</span>
        <span style="color:#888; font-size:12px;">ÎÖ∏ÎìúÎ•º ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏúÑÏπò Ï°∞Ï†ï</span>
        <div style="flex:1;"></div>
        <button onclick="app.applyLayoutEdit()" style="padding:8px 20px; background:linear-gradient(135deg, #4ecdc4, #44a08d); border:none; color:#fff; font-weight:bold; border-radius:4px; cursor:pointer;">
            Ï†ÅÏö©
        </button>
        <button onclick="app.closeLayoutEdit()" style="padding:8px 16px; background:#5a3a3a; border:none; color:#fff; border-radius:4px; cursor:pointer;">
            Ï∑®ÏÜå
        </button>
    </div>
    
    <!-- Ïö∞Ï∏° Î†àÏù¥ÏïÑÏõÉ ÏÑ§Ï†ï Ìå®ÎÑê -->
    <div id="layoutEditPanel" style="display:none; position:fixed; top:50px; right:0; width:240px; height:calc(100% - 50px); background:rgba(20,20,35,0.95); border-left:1px solid #4ecdc4; z-index:100; overflow-y:auto; padding:12px; box-sizing:border-box;">
        <h4 style="color:#4ecdc4; margin:0 0 12px 0; font-size:13px;">ÏÑ†ÌÉùÎêú ÎÖ∏Îìú</h4>
        
        <!-- ÏÑ†ÌÉùÎêú ÎÖ∏Îìú Ï†ïÎ≥¥ -->
        <div id="layoutNodeInfo" style="display:none;">
            <div style="margin-bottom:10px;">
                <label style="color:#888; font-size:10px; display:block; margin-bottom:3px;">Ïù¥Î¶Ñ</label>
                <input type="text" id="layoutNodeName" readonly style="width:100%; background:#0a0a15; border:1px solid #444; color:#fff; padding:6px; border-radius:4px; box-sizing:border-box; font-size:11px;">
            </div>
            
            <div style="margin-bottom:10px;">
                <label style="color:#888; font-size:10px; display:block; margin-bottom:3px;">ÌÅ¨Í∏∞ (m)</label>
                <div style="display:flex; gap:4px; align-items:center;">
                    <input type="number" id="layoutNodeWidth" min="8" max="50" value="20" style="flex:1; background:#0a0a15; border:1px solid #444; color:#fff; padding:5px; border-radius:4px; box-sizing:border-box; font-size:11px;" onchange="app.updateLayoutNode()">
                    <span style="color:#666; font-size:10px;">x</span>
                    <input type="number" id="layoutNodeHeight" min="8" max="50" value="20" style="flex:1; background:#0a0a15; border:1px solid #444; color:#fff; padding:5px; border-radius:4px; box-sizing:border-box; font-size:11px;" onchange="app.updateLayoutNode()">
                </div>
            </div>
            
            <div style="margin-bottom:10px;">
                <label style="color:#888; font-size:10px; display:block; margin-bottom:3px;">ÎÜíÏù¥ (m)</label>
                <input type="number" id="layoutNodeFloorHeight" min="-10" max="10" value="0" step="0.5" style="width:100%; background:#0a0a15; border:1px solid #444; color:#fff; padding:5px; border-radius:4px; box-sizing:border-box; font-size:11px;" onchange="app.updateLayoutNode()">
            </div>
            
            <button onclick="app.deleteLayoutNode()" style="width:100%; padding:6px; background:#5a2d2d; border:none; color:#fff; border-radius:4px; cursor:pointer; font-size:10px;">
                ÎÖ∏Îìú ÏÇ≠Ï†ú
            </button>
        </div>
        
        <!-- ÏÑ†ÌÉù Ïïà ÎêêÏùÑ Îïå -->
        <div id="layoutNoSelection" style="color:#666; text-align:center; padding:16px 0; font-size:11px;">
            ÎÖ∏ÎìúÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù
        </div>
        
        <!-- Íµ¨Î∂ÑÏÑ† -->
        <div style="border-top:1px solid #333; margin:12px 0;"></div>
        
        <!-- Ï†ÑÏ≤¥ ÎÖ∏Îìú Î™©Î°ù -->
        <h4 style="color:#888; margin:0 0 6px 0; font-size:10px;">ÎÖ∏Îìú Î™©Î°ù (<span id="layoutNodeCount">0</span>Í∞ú)</h4>
        <div id="layoutNodeList" style="max-height:300px; overflow-y:auto; font-size:9px;"></div>
    </div>

    <script>
        // Ïä¨ÎùºÏù¥Îçî Í∞í ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('maxStraight').addEventListener('input', e => {
            document.getElementById('maxStraightVal').textContent = e.target.value + 'm';
        });
        document.getElementById('maxSightline').addEventListener('input', e => {
            document.getElementById('maxSightlineVal').textContent = e.target.value + 'm';
        });
        document.getElementById('exposedMax').addEventListener('input', e => {
            document.getElementById('exposedMaxVal').textContent = e.target.value + 'm';
        });
    </script>
</body>
</html>
