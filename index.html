<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEVELFORGE - FPS Level Designer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- ÏÉÅÎã® Î©îÎâ¥Î∞î -->
        <header class="menubar">
            <div class="brand">
                <span class="logo">‚óÜ</span>
                <span class="title">LEVELFORGE</span>
                <span class="level-name-divider">|</span>
                <span id="levelNameDisplay" class="level-name" title="ÌÅ¥Î¶≠ÌïòÏó¨ Î†àÎ≤® Ïù¥Î¶Ñ Î≥ÄÍ≤Ω">Untitled</span>
            </div>
            <nav class="menu">
                <div class="menu-group">
                    <button id="newBtn" class="menu-btn" title="ÏÉà ÌîÑÎ°úÏ†ùÌä∏"><i class="fa-solid fa-file"></i></button>
                    <button id="openBtn" class="menu-btn" title="Ïó¥Í∏∞ (Ctrl+O)"><i class="fa-solid fa-folder-open"></i></button>
                    <button id="recentBtn" class="menu-btn" title="ÏµúÍ∑º ÌååÏùº"><i class="fa-solid fa-clock-rotate-left"></i></button>
                    <div id="recentDropdown" class="recent-dropdown" style="display:none;">
                        <div class="recent-header">ÏµúÍ∑º ÌååÏùº</div>
                        <ul id="recentList" class="recent-list"></ul>
                        <div class="recent-empty" id="recentEmpty">ÏµúÍ∑º ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§</div>
                    </div>
                    <button id="saveBtn" class="menu-btn" title="Ï†ÄÏû• (Ctrl+S)"><i class="fa-solid fa-floppy-disk"></i></button>
                    <button id="exportBtn" class="menu-btn" title="Ïù¥ÎØ∏ÏßÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞"><i class="fa-solid fa-image"></i></button>
                    <button id="exportBlenderBtn" class="menu-btn" title="BlenderÎ°ú ÎÇ¥Î≥¥ÎÇ¥Í∏∞" style="color:#ea7600"><i class="fa-solid fa-cube"></i>B</button>
                    <button id="view3dBtn" class="menu-btn" title="3D Î∑∞" style="color:#4ecdc4"><i class="fa-solid fa-cube"></i></button>
                </div>
                <div class="menu-divider"></div>
                <div class="menu-group">
                    <button id="undoBtn" class="menu-btn" title="Ïã§ÌñâÏ∑®ÏÜå (Ctrl+Z)"><i class="fa-solid fa-rotate-left"></i></button>
                    <button id="redoBtn" class="menu-btn" title="Îã§ÏãúÏã§Ìñâ (Ctrl+Y)"><i class="fa-solid fa-rotate-right"></i></button>
                </div>
                <div class="menu-divider"></div>
                <div class="menu-group tools-group" style="position:relative;">
                    <button class="menu-btn tool-btn active" data-tool="select" title="ÏÑ†ÌÉù ÎèÑÍµ¨ (V)&#10;Ïò§Î∏åÏ†ùÌä∏Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù"><i class="fa-solid fa-arrow-pointer"></i></button>
                    <button class="menu-btn tool-btn" data-tool="pan" title="Ïù¥Îèô ÎèÑÍµ¨ (Space)&#10;Ï∫îÎ≤ÑÏä§Î•º ÎìúÎûòÍ∑∏ÌïòÏó¨ Ïù¥Îèô"><i class="fa-solid fa-hand"></i></button>
                    <button class="menu-btn tool-btn" data-tool="polygon" title="Îã§Í∞ÅÌòï Î∞îÎã• (P)&#10;ÌÅ¥Î¶≠: Ï†ê Ï∂îÍ∞Ä&#10;Enter/ÎçîÎ∏îÌÅ¥Î¶≠: ÏôÑÏÑ±" style="color:#4ecdc4;"><i class="fa-solid fa-draw-polygon"></i></button>
                    <button class="menu-btn tool-btn" data-tool="spline" id="splineToolBtn" title="Ïä§ÌîåÎùºÏù∏ Î∞îÎã• (S)&#10;ÌÅ¥Î¶≠: Í≤ΩÎ°úÏ†ê Ï∂îÍ∞Ä&#10;Enter/ÎçîÎ∏îÌÅ¥Î¶≠: Î∞îÎã• ÏÉùÏÑ±" style="color:#f39c12;"><i class="fa-solid fa-bezier-curve"></i></button>
                    <!-- Ïä§ÌîåÎùºÏù∏ ÏòµÏÖò ÌåùÏóÖ -->
                    <div class="spline-popup" id="splineOptions" style="display:none;">
                        <div class="spline-popup-title">ÌÜµÎ°ú ÎÑàÎπÑ</div>
                        <div class="spline-popup-controls">
                            <button id="splineWidthMinus" class="spline-popup-btn">‚àí</button>
                            <span id="splineWidthLabel" class="spline-popup-value">5m</span>
                            <button id="splineWidthPlus" class="spline-popup-btn">+</button>
                        </div>
                        <input type="range" id="splineWidth" min="32" max="320" value="160" step="32" class="spline-popup-slider">
                    </div>
                </div>
                <div class="menu-divider"></div>
                <div class="menu-group markers-group">
                    <button class="menu-btn tool-btn" data-tool="spawn-def" title="Defence Spawn&#10;ÏàòÎπÑÌåÄ ÏãúÏûë ÏúÑÏπò (10√ó10m)" style="color:#27ae60;"><i class="fa-solid fa-shield-halved"></i></button>
                    <button class="menu-btn tool-btn" data-tool="spawn-off" title="Offence Spawn&#10;Í≥µÍ≤©ÌåÄ ÏãúÏûë ÏúÑÏπò (10√ó10m)" style="color:#e74c3c;"><i class="fa-solid fa-crosshairs"></i></button>
                    <button class="menu-btn tool-btn" data-tool="objective" title="Objective Point&#10;Ï†êÎ†π Î™©Ìëú ÏßÄÏ†ê (16√ó16m)" style="color:#f39c12;"><i class="fa-solid fa-flag"></i></button>
                </div>
                <div class="menu-divider"></div>
                <div class="menu-group zoom-group">
                    <button id="zoomOut" class="menu-btn" title="Ï∂ïÏÜå"><i class="fa-solid fa-minus"></i></button>
                    <span id="zoomLevel" class="zoom-display">100%</span>
                    <button id="zoomIn" class="menu-btn" title="ÌôïÎåÄ"><i class="fa-solid fa-plus"></i></button>
                    <button id="zoomFit" class="menu-btn" title="ÎßûÏ∂îÍ∏∞"><i class="fa-solid fa-expand"></i></button>
                </div>
            </nav>
            <div class="menu-right">
                <label class="toggle-label">
                    <input type="checkbox" id="gridToggle" checked>
                    <span>Í∑∏Î¶¨Îìú</span>
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="snapToggle" checked>
                    <span>Ïä§ÎÉÖ</span>
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="diagSnapToggle">
                    <span>45¬∞</span>
                </label>
                <select id="gridSizeSelect" class="mini-select" title="1Ïπ∏ = 1m">
                    <option value="32" selected>1m</option>
                    <option value="64">2m</option>
                    <option value="16">0.5m</option>
                </select>
            </div>
            <input type="file" id="fileInput" accept=".json,.lvl" style="display:none">
        </header>

        <main class="workspace">
            <!-- ÏôºÏ™Ω ÎèÑÍµ¨ Ìå®ÎÑê -->
            <aside class="tool-panel">
                <div class="tool-section">
                    <div class="tool-section-title">SIMULATION</div>
                    <button id="simPreviewBtn" class="tool-btn-wide" title="Í≤ΩÎ°ú ÎØ∏Î¶¨Î≥¥Í∏∞" style="background:#3d3a5a;">
                        <i class="fa-solid fa-route" style="color:#a29bfe"></i>
                        <span>Í≤ΩÎ°ú ÎØ∏Î¶¨Î≥¥Í∏∞</span>
                    </button>
                    <button id="simStartBtn" class="tool-btn-wide" title="ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏãúÏûë" style="background:#2d4a5a; margin-top:4px;">
                        <i class="fa-solid fa-play" style="color:#4ecdc4"></i>
                        <span>ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏãúÏûë</span>
                    </button>
                    <button id="simStopBtn" class="tool-btn-wide" title="ÏãúÎÆ¨Î†àÏù¥ÏÖò Ï†ïÏßÄ" style="background:#5a2d2d; margin-top:4px; display:none;">
                        <i class="fa-solid fa-stop" style="color:#e74c3c"></i>
                        <span>Ï†ïÏßÄ</span>
                    </button>
                    <button id="simPinBtn" class="tool-btn-wide" title="ÌïÄ ÍΩÇÍ∏∞ - ÌÅ¥Î¶≠ ÏúÑÏπòÎ°ú Î™®Îì† ÏóêÏù¥Ï†ÑÌä∏ Ïù¥Îèô" style="background:#5a4a2d; margin-top:4px; display:none;">
                        <i class="fa-solid fa-map-pin" style="color:#f39c12"></i>
                        <span>ÌïÄ ÍΩÇÍ∏∞ Î™®Îìú</span>
                    </button>
                    <div id="simStatus" style="font-size:10px;color:#888;margin-top:4px;padding:0 4px;">
                        Defence/Offence Î∞∞Ïπò ÌõÑ ÏãúÏûë
                    </div>
                </div>

                <input type="file" id="refImageInput" accept="image/*" style="display:none">

                <div class="tool-section ai-section">
                    <div class="tool-section-title">AI ASSISTANT</div>
                    <button id="aiChatBtn" class="tool-btn-wide" title="AIÏôÄ Î†àÎ≤® ÎîîÏûêÏù∏ ÏÉÅÎã¥" style="background:#4a3d5a;">
                        <i class="fa-solid fa-robot" style="color:#a29bfe"></i>
                        <span>AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏</span>
                    </button>
                    <div id="aiStatus" style="font-size:10px;color:#888;margin-top:4px;padding:0 4px;">
                        Î†àÎ≤® Î∂ÑÏÑù Î∞è ÎîîÏûêÏù∏ Ï°∞Ïñ∏
                    </div>
                </div>

                <div class="tool-section objects-section">
                    <div class="tool-section-title">
                        OBJECTS <span id="objectCount" class="badge">0</span>
                    </div>
                    <div class="objects-list-container">
                        <ul id="objectsList" class="objects-ul"></ul>
                    </div>
                </div>
            </aside>

            <!-- AI Ï±ÑÌåÖ Ìå®ÎÑê -->
            <div id="aiPanel" class="ai-panel" style="display:none;">
                <div class="ai-panel-header">
                    <span><i class="fa-solid fa-robot"></i> AI Level Designer</span>
                    <button id="aiCloseBtn" class="ai-close-btn"><i class="fa-solid fa-times"></i></button>
                </div>
                <div id="aiMessages" class="ai-messages"></div>
                <div class="ai-input-area">
                    <div class="ai-quick-actions">
                        <button class="ai-quick-btn" data-prompt="ÌòÑÏû¨ Î†àÎ≤®ÏùÑ Î∂ÑÏÑùÌïòÍ≥† Í∞úÏÑ†Ï†êÏùÑ ÏïåÎ†§Ï§ò">üìä Î∂ÑÏÑù</button>
                        <button class="ai-quick-btn" data-prompt="Ï¥àÌÅ¨Ìè¨Ïù∏Ìä∏ÏôÄ ÏÇ¨Ïù¥Ìä∏ÎùºÏù∏ÏùÑ Ï≤¥ÌÅ¨Ìï¥Ï§ò">üéØ Ï¥àÌÅ¨Ìè¨Ïù∏Ìä∏</button>
                        <button class="ai-quick-btn" data-prompt="Î∞∏Îü∞Ïä§ Î¨∏Ï†úÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏Ìï¥Ï§ò">‚öñÔ∏è Î∞∏Îü∞Ïä§</button>
                    </div>
                    <div class="ai-input-row">
                        <input type="text" id="aiInput" placeholder="Î†àÎ≤® ÎîîÏûêÏù∏Ïóê ÎåÄÌï¥ ÏßàÎ¨∏ÌïòÏÑ∏Ïöî..." />
                        <button id="aiSendBtn"><i class="fa-solid fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

            <!-- Ï∫îÎ≤ÑÏä§ ÏòÅÏó≠ -->
            <div class="canvas-area">
                <div class="canvas-container" id="canvasContainer">
                    <canvas id="gridCanvas"></canvas>
                    <canvas id="mainCanvas"></canvas>
                    <canvas id="uiCanvas"></canvas>
                </div>
                <div class="canvas-info">
                    <span id="coordsDisplay">0m, 0m</span>
                    <span id="objectInfo">-</span>
                    <span id="hintText">V: ÏÑ†ÌÉù | P: Îã§Í∞ÅÌòï | S: Ïä§ÌîåÎùºÏù∏ | Enter: ÏôÑÏÑ± | Esc: Ï∑®ÏÜå</span>
                </div>
            </div>

            <!-- Ïò§Î•∏Ï™Ω ÏÜçÏÑ± Ìå®ÎÑê -->
            <aside class="props-panel">
                <div class="props-section">
                    <div class="props-header">
                        <span>PROPERTIES</span>
                    </div>
                    <div id="propsContent" class="props-content">
                        <div class="props-empty">
                            <i class="fa-solid fa-cube"></i>
                            <p>Ïò§Î∏åÏ†ùÌä∏Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
                        </div>
                    </div>
                </div>

                <div class="props-section">
                    <div class="props-header">
                        <span>HEIGHT (ÎÜíÏù¥)</span>
                    </div>
                    <div class="props-content">
                        <div class="height-control">
                            <label>Î∞îÎã• ÎÜíÏù¥</label>
                            <div class="height-input-row">
                                <input type="number" id="floorHeight" value="0" step="0.5" min="-10" max="50">
                                <span>m</span>
                            </div>
                            <div class="height-presets">
                                <button class="height-btn" data-height="0">0m</button>
                                <button class="height-btn" data-height="1">1m</button>
                                <button class="height-btn" data-height="2">2m</button>
                                <button class="height-btn" data-height="3">3m</button>
                                <button class="height-btn" data-height="-1">-1m</button>
                            </div>
                        </div>
                    </div>
                </div>

            </aside>
        </main>
    </div>

    <!-- 3D Î∑∞Ïñ¥ Î™®Îã¨ -->
    <div id="viewer3dModal" class="modal-overlay" style="display:none">
        <div class="modal-3d">
            <div class="modal-3d-header">
                <span>3D VIEW</span>
                <div class="modal-3d-controls">
                    <button id="walkModeBtn">üö∂ ÏõåÌÅ¨ Î™®Îìú</button>
                    <label><input type="checkbox" id="wireframeToggle"> ÏôÄÏù¥Ïñ¥ÌîÑÎ†àÏûÑ</label>
                    <label><input type="checkbox" id="gridToggle3d" checked> Í∑∏Î¶¨Îìú</label>
                    <button id="resetCamera3d">Ïπ¥Î©îÎùº Î¶¨ÏÖã</button>
                    <button id="close3dBtn"><i class="fa-solid fa-xmark"></i></button>
                </div>
            </div>
            <div id="viewer3dContainer"></div>
            <div class="modal-3d-info">
                <span id="viewerInfoText">ÎßàÏö∞Ïä§ ÎìúÎûòÍ∑∏: ÌöåÏ†Ñ | Ïä§ÌÅ¨Î°§: Ï§å | Ïö∞ÌÅ¥Î¶≠ ÎìúÎûòÍ∑∏: Ïù¥Îèô</span>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="level-rules.js"></script>
    <script src="app.js"></script>
    <script src="viewer3d.js"></script>
</body>
</html>
